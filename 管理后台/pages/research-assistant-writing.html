<!-- ç§‘ç ”è¶…çº§æ™ºèƒ½ä½“ï¼šè¾…åŠ©å†™ä½œé¡µé¢ -->
<div class="assistant-writing-page">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="writing-header">
        <div class="writing-title-section">
            <div class="writing-icon">âœï¸</div>
            <h1 class="writing-title">è¾…åŠ©å†™ä½œè¶…çº§æ™ºèƒ½ä½“</h1>
        </div>
    </div>
    
    <!-- ä¸»è¦è¾“å…¥åŒºåŸŸ -->
    <div class="writing-input-section" id="writingInputSection">
        <div class="writing-input-container">
            <!-- åŠŸèƒ½æŒ‰é’®ï¼ˆåœ¨è¾“å…¥æ¡†å†…éƒ¨ï¼Œé»˜è®¤éšè—ï¼‰ -->
            <div class="feature-btn-inline" id="featureBtnInline" style="display: none;">
                <button class="feature-btn-tag" onclick="clearFeature()">
                    <span class="feature-btn-title" id="featureBtnTitle">åŠŸèƒ½åç§°</span>
                    <span class="feature-btn-desc" id="featureBtnDesc">åŠŸèƒ½æè¿°</span>
                    <span class="feature-btn-close">Ã—</span>
                </button>
            </div>
            
            <textarea 
                class="writing-input" 
                id="writingQuestionInput"
                placeholder="è¯¢é—®ä»»ä½•é—®é¢˜, æå‡ºä»»ä½•éœ€æ±‚ (è¾“å…¥@å¿«é€Ÿæ·»åŠ çŸ¥è¯†åº“)"
                rows="4"
            ></textarea>
            <div class="writing-input-actions">
                <button class="writing-action-btn" onclick="addKnowledgeBase()">
                    <span>+</span>
                    <span>æ·»åŠ çŸ¥è¯†åº“</span>
                </button>
                <div class="writing-input-icons">
                    <button class="writing-icon-btn" onclick="attachFile()" title="é™„ä»¶">
                        <span>ğŸ“</span>
                    </button>
                    <button class="writing-icon-btn" onclick="startVoiceInput()" title="è¯­éŸ³è¾“å…¥">
                        <span>ğŸ¤</span>
                    </button>
                    <button class="writing-icon-btn writing-submit-btn" onclick="submitQuestion()" title="æäº¤">
                        <span>â†’</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ç¤ºä¾‹åˆ—è¡¨ï¼ˆå½“é€‰æ‹©åŠŸèƒ½æ—¶æ˜¾ç¤ºï¼‰ -->
        <div class="feature-examples-section" id="featureExamplesSection" style="display: none;">
            <div class="section-title">
                <h3>ç¤ºä¾‹</h3>
            </div>
            <div class="feature-examples-list" id="featureExamplesList">
                <!-- ç¤ºä¾‹åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>
    
    <!-- çƒ­é—¨ä»»åŠ¡ -->
    <div class="hot-tasks-section">
        <div class="section-title">
            <span class="title-icon">ğŸ”¥</span>
            <h2>çƒ­é—¨ä»»åŠ¡</h2>
        </div>
        <div class="hot-tasks-grid">
            <div class="task-card" onclick="openTask('topic-selection')">
                <div class="task-icon">â°</div>
                <div class="task-title">å¯»æ‰¾é€‰é¢˜</div>
                <div class="task-desc">èšç„¦çƒ­ç‚¹Â·æ´å¯Ÿè¶‹åŠ¿Â·å¯å‘çµæ„Ÿ</div>
                <div class="task-benefit">
                    <span class="benefit-icon">ğŸ“Š</span>
                    <span class="benefit-text">å¹³å‡ç¼©çŸ­60%é€‰é¢˜å‘¨æœŸ</span>
                </div>
            </div>
            <div class="task-card" onclick="openTask('literature-search')">
                <div class="task-icon">â°</div>
                <div class="task-title">æ£€ç´¢æ–‡çŒ®</div>
                <div class="task-desc">æ™ºèƒ½ç­›é€‰Â·å¤šç»´æ£€ç´¢Â·ç²¾å‡†å®šä½</div>
                <div class="task-benefit">
                    <span class="benefit-icon">ğŸ“Š</span>
                    <span class="benefit-text">å¹³å‡èŠ‚çœ80%æ£€ç´¢æ—¶é—´</span>
                </div>
            </div>
            <div class="task-card" onclick="openTask('literature-download')">
                <div class="task-icon">â¬‡ï¸</div>
                <div class="task-title">ä¸‹è½½æ–‡çŒ®</div>
                <div class="task-desc">ä¸€é”®è·å–Â·æ‰¹é‡ä¸‹è½½Â·è‡ªåŠ¨æ•´ç†</div>
                <div class="task-benefit">
                    <span class="benefit-icon">ğŸ“Š</span>
                    <span class="benefit-text">æ”¯æŒ95%ä»¥ä¸Šæ–‡çŒ®ä¸‹è½½</span>
                </div>
            </div>
            <div class="task-card" onclick="openTask('literature-review')">
                <div class="task-icon">ğŸ“ˆ</div>
                <div class="task-title">æ–‡çŒ®ç»¼è¿°</div>
                <div class="task-desc">æ™ºèƒ½åˆ†æÂ·æ¡†æ¶ç”ŸæˆÂ·è¶‹åŠ¿æŠŠæ¡</div>
                <div class="task-benefit">
                    <span class="benefit-icon">ğŸ“Š</span>
                    <span class="benefit-text">ç»¼è¿°æ•ˆç‡æå‡70%</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- å¯ä»¥ä»è¿™é‡Œå¼€å§‹ -->
    <div class="start-here-section" id="startHereSection">
        <div class="section-title">
            <h2>å¯ä»¥ä»è¿™é‡Œå¼€å§‹</h2>
        </div>
        <div class="start-here-grid">
            <!-- ç ”ç©¶å‡†å¤‡ -->
            <div class="category-column">
                <div class="category-title">ç ”ç©¶å‡†å¤‡</div>
                <div class="category-items">
                    <div class="category-item" onclick="openFeature('search-literature')">
                        <div class="item-icon">ğŸ”</div>
                        <div class="item-text">æ£€ç´¢æ–‡çŒ®</div>
                    </div>
                    <div class="category-item" onclick="openFeature('download-literature')">
                        <div class="item-icon">ğŸ“</div>
                        <div class="item-text">æ–‡çŒ®ä¸‹è½½</div>
                    </div>
                    <div class="category-item" onclick="openFeature('read-literature')">
                        <div class="item-icon">ğŸ“–</div>
                        <div class="item-text">æ–‡çŒ®é˜…è¯»</div>
                    </div>
                    <div class="category-item" onclick="openFeature('topic-selection')">
                        <div class="item-icon">ğŸ’¡</div>
                        <div class="item-text">é€‰é¢˜</div>
                    </div>
                    <div class="category-item" onclick="openFeature('organize-notes')">
                        <div class="item-icon">ğŸ“‹</div>
                        <div class="item-text">ç¬”è®°æ•´ç†</div>
                    </div>
                </div>
            </div>
            
            <!-- å†™ä½œä¸å‘è¡¨ -->
            <div class="category-column">
                <div class="category-title">å†™ä½œä¸å‘è¡¨</div>
                <div class="category-items">
                    <div class="category-item" onclick="openFeature('generate-outline')">
                        <div class="item-icon">ğŸ“„</div>
                        <div class="item-text">å‡ºæçº²</div>
                    </div>
                    <div class="category-item" onclick="openFeature('writing')">
                        <div class="item-icon">âœï¸</div>
                        <div class="item-text">å†™ä½œ</div>
                    </div>
                    <div class="category-item" onclick="openFeature('polish')">
                        <div class="item-icon">â­</div>
                        <div class="item-text">æ¶¦è‰²</div>
                    </div>
                    <div class="category-item" onclick="openFeature('translate')">
                        <div class="item-icon">ğŸŒ</div>
                        <div class="item-text">ç¿»è¯‘</div>
                    </div>
                    <div class="category-item" onclick="openFeature('literature-review')">
                        <div class="item-icon">ğŸ“Š</div>
                        <div class="item-text">æ–‡çŒ®ç»¼è¿°</div>
                    </div>
                </div>
            </div>
            
            <!-- ç ”ç©¶è¾…åŠ©ï¼ˆæš‚æ—¶ç¦ç”¨ï¼‰ -->
            <div class="category-column disabled">
                <div class="category-title">ç ”ç©¶è¾…åŠ©</div>
                <div class="category-items">
                    <div class="category-item disabled" title="åŠŸèƒ½å¼€å‘ä¸­">
                        <div class="item-icon">ğŸ“„</div>
                        <div class="item-text">è°ƒç ”æŠ¥å‘Š</div>
                    </div>
                    <div class="category-item disabled" title="åŠŸèƒ½å¼€å‘ä¸­">
                        <div class="item-icon">ğŸ“Š</div>
                        <div class="item-text">æ•°æ®åˆ†æ</div>
                    </div>
                    <div class="category-item disabled" title="åŠŸèƒ½å¼€å‘ä¸­">
                        <div class="item-icon">ğŸ—ºï¸</div>
                        <div class="item-text">è„‘å›¾æ¢³ç†</div>
                    </div>
                    <div class="category-item disabled" title="åŠŸèƒ½å¼€å‘ä¸­">
                        <div class="item-icon">ğŸ§ª</div>
                        <div class="item-text">ç ”ç©¶è®¾è®¡</div>
                    </div>
                    <div class="category-item disabled" title="åŠŸèƒ½å¼€å‘ä¸­">
                        <div class="item-icon">â“</div>
                        <div class="item-text">è°ƒç ”é—®å·</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- æ·»åŠ å‚è€ƒèµ„æ–™æ¨¡æ€æ¡† -->
    <div class="add-kb-modal" id="addKnowledgeBaseModal" style="display: none;">
        <div class="add-kb-overlay" onclick="closeAddKBModal()"></div>
        <div class="add-kb-content">
            <div class="add-kb-header">
                <h3 class="add-kb-title">æ·»åŠ å‚è€ƒèµ„æ–™</h3>
                <button class="add-kb-close" onclick="closeAddKBModal()">Ã—</button>
            </div>
            <div class="add-kb-body">
                <p class="add-kb-desc">é€‰æ‹©çŸ¥è¯†åº“ã€æ–‡æ¡£ã€æ‘˜å½•ã€ç¬”è®°ï¼Œè®©å­¦æœ¯è¶…çº§æ™ºèƒ½ä½“å›´ç»•çŸ¥è¯†åº“å›ç­”</p>
                <div class="add-kb-search">
                    <div class="search-icon">ğŸ”</div>
                    <input type="text" class="add-kb-search-input" placeholder="æœç´¢çŸ¥è¯†åº“å†…å®¹..." id="kbSearchInput">
                </div>
                <div class="add-kb-list" id="kbList">
                    <div class="add-kb-empty">æš‚æ— çŸ¥è¯†åº“</div>
                </div>
            </div>
            <div class="add-kb-footer">
                <div class="add-kb-count" id="kbSelectedCount">å·²é€‰ 0/5 é¡¹</div>
                <div class="add-kb-actions">
                    <button class="btn btn-default" onclick="closeAddKBModal()">å–æ¶ˆ</button>
                    <button class="btn btn-primary" id="confirmAddKB" onclick="confirmAddKB()" disabled>ç¡®è®¤æ·»åŠ </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* è¾…åŠ©å†™ä½œé¡µé¢æ ·å¼ */
.assistant-writing-page {
    padding: 24px;
    max-width: 1400px;
    margin: 0 auto;
}

.writing-header {
    text-align: center;
    margin-bottom: 32px;
}

.writing-title-section {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    margin-bottom: 8px;
}

.writing-icon {
    font-size: 48px;
}

.writing-title {
    font-size: 36px;
    font-weight: 600;
    color: #1a1a1a;
    margin: 0;
}


/* è¾“å…¥åŒºåŸŸ */
.writing-input-section {
    margin-bottom: 40px;
}

/* åŠŸèƒ½æŒ‰é’®ï¼ˆè¾“å…¥æ¡†å†…éƒ¨ï¼‰ */
.feature-btn-inline {
    position: absolute;
    top: 12px;
    left: 12px;
    z-index: 10;
}

.feature-btn-tag {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 6px 12px;
    background: #e6f7ff;
    border: 1px solid #91d5ff;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s;
    font-size: 13px;
}

.feature-btn-tag:hover {
    background: #bae7ff;
    border-color: #1890ff;
}

.feature-btn-title {
    font-weight: 600;
    color: #1890ff;
}

.feature-btn-desc {
    color: #666;
    font-size: 12px;
}

.feature-btn-close {
    width: 16px;
    height: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #999;
    font-size: 14px;
    margin-left: 4px;
    transition: color 0.3s;
}

.feature-btn-tag:hover .feature-btn-close {
    color: #1a1a1a;
}

.writing-input-container {
    position: relative;
    max-width: 900px;
    margin: 0 auto;
}

.writing-input {
    width: 100%;
    padding: 16px 200px 16px 16px;
    border: 1px solid #d9d9d9;
    border-radius: 8px;
    font-size: 16px;
    resize: vertical;
    min-height: 120px;
    font-family: inherit;
    transition: all 0.3s;
}

/* å½“æœ‰åŠŸèƒ½æŒ‰é’®æ—¶ï¼Œè°ƒæ•´è¾“å…¥æ¡†å†…è¾¹è· */
.writing-input-container.has-feature .writing-input {
    padding-top: 50px;
}

.writing-input:focus {
    outline: none;
    border-color: #1890ff;
    box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.1);
}

.writing-input-actions {
    position: absolute;
    right: 12px;
    bottom: 12px;
    display: flex;
    gap: 8px;
    align-items: center;
}

.writing-action-btn {
    padding: 8px 16px;
    border: 1px solid #d9d9d9;
    border-radius: 6px;
    background: #fff;
    color: #666;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: all 0.3s;
}

.writing-action-btn:hover {
    border-color: #1890ff;
    color: #1890ff;
}

.writing-input-icons {
    display: flex;
    gap: 8px;
}

.writing-icon-btn {
    width: 36px;
    height: 36px;
    border: none;
    border-radius: 50%;
    background: #f0f0f0;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    transition: all 0.3s;
}

.writing-icon-btn:hover {
    background: #e0e0e0;
}

.writing-submit-btn {
    background: #1890ff;
    color: #fff;
}

.writing-submit-btn:hover {
    background: #40a9ff;
}

/* çƒ­é—¨ä»»åŠ¡ */
.hot-tasks-section {
    margin-bottom: 40px;
}

.section-title {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 20px;
}

.title-icon {
    font-size: 24px;
}

.section-title h2 {
    font-size: 20px;
    font-weight: 600;
    color: #1a1a1a;
    margin: 0;
}

.hot-tasks-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.task-card {
    background: #fff;
    border: 1px solid #e8e8e8;
    border-radius: 8px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.3s;
}

.task-card:hover {
    border-color: #1890ff;
    box-shadow: 0 2px 8px rgba(24, 144, 255, 0.1);
    transform: translateY(-2px);
}

.task-icon {
    font-size: 32px;
    margin-bottom: 12px;
}

.task-title {
    font-size: 16px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 8px;
}

.task-desc {
    font-size: 14px;
    color: #666;
    margin-bottom: 12px;
    line-height: 1.5;
}

.task-benefit {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
    color: #999;
}

.benefit-icon {
    font-size: 14px;
}

/* å¯ä»¥ä»è¿™é‡Œå¼€å§‹ */
.start-here-section {
    margin-bottom: 40px;
}

.start-here-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 24px;
}

.category-column {
    background: #fff;
    border: 1px solid #e8e8e8;
    border-radius: 8px;
    padding: 20px;
}

.category-column.disabled {
    opacity: 0.5;
    pointer-events: none;
}

.category-title {
    font-size: 16px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 16px;
    padding-bottom: 12px;
    border-bottom: 1px solid #e8e8e8;
}

.category-items {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.category-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    border: 1px solid #e8e8e8;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s;
}

.category-item:hover:not(.disabled) {
    border-color: #1890ff;
    background: #f0f7ff;
}

.category-item.disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: #f5f5f5;
}

.item-icon {
    font-size: 20px;
    flex-shrink: 0;
}

.item-text {
    font-size: 14px;
    color: #1a1a1a;
}

.category-item.disabled .item-text {
    color: #999;
}

/* ç¤ºä¾‹åŒºåŸŸï¼ˆåœ¨è¾“å…¥åŒºåŸŸä¸‹æ–¹ï¼‰ */
.feature-examples-section {
    margin-top: 20px;
    max-width: 900px;
    margin-left: auto;
    margin-right: auto;
}

.feature-examples-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.feature-example-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 20px;
    background: #f5f5f5;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s;
}

.feature-example-item:hover {
    background: #e6f7ff;
    border: 1px solid #1890ff;
}

.example-text {
    font-size: 14px;
    color: #1a1a1a;
}

.example-arrow {
    font-size: 16px;
    color: #1890ff;
}

/* æ·»åŠ å‚è€ƒèµ„æ–™æ¨¡æ€æ¡† */
.add-kb-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
}

.add-kb-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
}

.add-kb-content {
    position: relative;
    background: #fff;
    border-radius: 8px;
    width: 90%;
    max-width: 600px;
    max-height: 80vh;
    display: flex;
    flex-direction: column;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
}

.add-kb-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 24px;
    border-bottom: 1px solid #e8e8e8;
}

.add-kb-title {
    font-size: 18px;
    font-weight: 600;
    color: #1a1a1a;
    margin: 0;
}

.add-kb-close {
    width: 32px;
    height: 32px;
    border: none;
    background: transparent;
    font-size: 24px;
    cursor: pointer;
    color: #999;
    display: flex;
    align-items: center;
    justify-content: center;
}

.add-kb-close:hover {
    color: #1a1a1a;
}

.add-kb-body {
    flex: 1;
    overflow-y: auto;
    padding: 24px;
}

.add-kb-desc {
    font-size: 14px;
    color: #666;
    margin: 0 0 16px 0;
    line-height: 1.5;
}

.add-kb-search {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 12px;
    border: 1px solid #d9d9d9;
    border-radius: 6px;
    margin-bottom: 16px;
}

.search-icon {
    font-size: 16px;
    color: #999;
}

.add-kb-search-input {
    flex: 1;
    border: none;
    outline: none;
    font-size: 14px;
}

.add-kb-list {
    min-height: 200px;
    max-height: 400px;
    overflow-y: auto;
}

.add-kb-empty {
    text-align: center;
    padding: 60px 20px;
    color: #999;
    font-size: 14px;
}

.add-kb-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    border: 1px solid #e8e8e8;
    border-radius: 6px;
    margin-bottom: 8px;
    cursor: pointer;
    transition: all 0.3s;
}

.add-kb-item:hover {
    border-color: #1890ff;
    background: #f0f7ff;
}

.add-kb-item.selected {
    border-color: #1890ff;
    background: #e6f7ff;
}

.add-kb-item-checkbox {
    width: 18px;
    height: 18px;
    border: 2px solid #d9d9d9;
    border-radius: 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
}

.add-kb-item.selected .add-kb-item-checkbox {
    background: #1890ff;
    border-color: #1890ff;
}

.add-kb-item.selected .add-kb-item-checkbox::after {
    content: 'âœ“';
    color: #fff;
    font-size: 12px;
}

.add-kb-item-info {
    flex: 1;
}

.add-kb-item-name {
    font-size: 14px;
    font-weight: 500;
    color: #1a1a1a;
    margin-bottom: 4px;
}

.add-kb-item-desc {
    font-size: 12px;
    color: #999;
}

.add-kb-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 24px;
    border-top: 1px solid #e8e8e8;
}

.add-kb-count {
    font-size: 14px;
    color: #666;
}

.add-kb-actions {
    display: flex;
    gap: 12px;
}

.btn {
    padding: 8px 24px;
    border: 1px solid #d9d9d9;
    border-radius: 6px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s;
}

.btn-default {
    background: #fff;
    color: #666;
}

.btn-default:hover {
    border-color: #1890ff;
    color: #1890ff;
}

.btn-primary {
    background: #1890ff;
    color: #fff;
    border-color: #1890ff;
}

.btn-primary:hover:not(:disabled) {
    background: #40a9ff;
    border-color: #40a9ff;
}

.btn-primary:disabled {
    background: #d9d9d9;
    border-color: #d9d9d9;
    color: #fff;
    cursor: not-allowed;
    opacity: 0.6;
}
</style>

<script>
// æ‰“å¼€ä»»åŠ¡ï¼ˆä½¿ç”¨ä¸openFeatureç›¸åŒçš„é€»è¾‘ï¼‰
function openTask(taskType) {
    // ç›´æ¥è°ƒç”¨openFeatureï¼Œå› ä¸ºçƒ­é—¨ä»»åŠ¡çš„åŠŸèƒ½ä¹Ÿåœ¨featureConfigä¸­
    openFeature(taskType);
}

// å½“å‰é€‰ä¸­çš„åŠŸèƒ½
let currentFeature = null;

// åŠŸèƒ½é…ç½®
const featureConfig = {
    // çƒ­é—¨ä»»åŠ¡
    'topic-selection': {
        title: 'å¯»æ‰¾é€‰é¢˜',
        desc: 'èšç„¦çƒ­ç‚¹Â·æ´å¯Ÿè¶‹åŠ¿Â·å¯å‘çµæ„Ÿ',
        placeholder: 'è¾“å…¥ç ”ç©¶é¢†åŸŸæˆ–æ„Ÿå…´è¶£çš„æ–¹å‘ï¼Œè·å¾—é€‰é¢˜å»ºè®®',
        examples: [
            'çƒ­ç‚¹é€‰é¢˜æ¨è',
            'åˆ›æ–°é€‰é¢˜æŒ–æ˜',
            'é€‰é¢˜å¯è¡Œæ€§åˆ†æ'
        ]
    },
    'literature-search': {
        title: 'æ£€ç´¢æ–‡çŒ®',
        desc: 'æ™ºèƒ½ç­›é€‰Â·å¤šç»´æ£€ç´¢Â·ç²¾å‡†å®šä½',
        placeholder: 'è¾“å…¥å…³é”®è¯ã€æ ‡é¢˜ã€ä½œè€…æˆ–DOIè¿›è¡Œæ–‡çŒ®æ£€ç´¢',
        examples: [
            'åŸºäºå…³é”®è¯çš„ç²¾å‡†æ£€ç´¢',
            'å¤šç»´åº¦ç»„åˆæ£€ç´¢',
            'é«˜çº§æ£€ç´¢æŠ€å·§'
        ]
    },
    'literature-download': {
        title: 'ä¸‹è½½æ–‡çŒ®',
        desc: 'ä¸€é”®è·å–Â·æ‰¹é‡ä¸‹è½½Â·è‡ªåŠ¨æ•´ç†',
        placeholder: 'è¾“å…¥æ–‡çŒ®æ ‡é¢˜ã€DOIæˆ–é“¾æ¥ï¼Œä¸€é”®ä¸‹è½½æ–‡çŒ®',
        examples: [
            'æ‰¹é‡ä¸‹è½½ç›¸å…³æ–‡çŒ®',
            'æ ¹æ®DOIä¸‹è½½',
            'ä»é“¾æ¥ä¸‹è½½æ–‡çŒ®'
        ]
    },
    'literature-review': {
        title: 'æ–‡çŒ®ç»¼è¿°',
        desc: 'æ™ºèƒ½åˆ†æÂ·æ¡†æ¶ç”ŸæˆÂ·è¶‹åŠ¿æŠŠæ¡',
        placeholder: 'è¾“å…¥æ‚¨æƒ³å†™çš„æ–‡çŒ®ç»¼è¿°çš„ä¸»é¢˜å’Œå­—æ•°ç­‰è¦æ±‚',
        examples: [
            'PRISMA æ ‡å‡†ç³»ç»Ÿæ€§ç»¼è¿°',
            'èŸèƒåˆ†æç»Ÿè®¡ç»¼åˆ',
            'é¢†åŸŸç†è®ºæ¼”è¿›è„‰ç»œæ¢³ç†'
        ]
    },
    // ç ”ç©¶å‡†å¤‡
    'search-literature': {
        title: 'æ£€ç´¢æ–‡çŒ®',
        desc: 'è¾“å…¥å…³é”®è¯ã€æ ‡é¢˜ã€ä½œè€…æˆ–DOIè¿›è¡Œæ–‡çŒ®æ£€ç´¢',
        placeholder: 'è¾“å…¥å…³é”®è¯ã€æ ‡é¢˜ã€ä½œè€…æˆ–DOIè¿›è¡Œæ–‡çŒ®æ£€ç´¢',
        examples: [
            'åŸºäºå…³é”®è¯çš„ç²¾å‡†æ£€ç´¢',
            'å¤šç»´åº¦ç»„åˆæ£€ç´¢',
            'é«˜çº§æ£€ç´¢æŠ€å·§'
        ]
    },
    'download-literature': {
        title: 'æ–‡çŒ®ä¸‹è½½',
        desc: 'è¾“å…¥æ–‡çŒ®æ ‡é¢˜ã€DOIæˆ–é“¾æ¥ï¼Œä¸€é”®ä¸‹è½½æ–‡çŒ®',
        placeholder: 'è¾“å…¥æ–‡çŒ®æ ‡é¢˜ã€DOIæˆ–é“¾æ¥ï¼Œä¸€é”®ä¸‹è½½æ–‡çŒ®',
        examples: [
            'æ‰¹é‡ä¸‹è½½ç›¸å…³æ–‡çŒ®',
            'æ ¹æ®DOIä¸‹è½½',
            'ä»é“¾æ¥ä¸‹è½½æ–‡çŒ®'
        ]
    },
    'read-literature': {
        title: 'æ–‡çŒ®é˜…è¯»',
        desc: 'ä¸Šä¼ æˆ–è¾“å…¥æ–‡çŒ®ï¼Œè¿›è¡Œæ™ºèƒ½é˜…è¯»å’Œåˆ†æ',
        placeholder: 'ä¸Šä¼ æˆ–è¾“å…¥æ–‡çŒ®ï¼Œè¿›è¡Œæ™ºèƒ½é˜…è¯»å’Œåˆ†æ',
        examples: [
            'æ–‡çŒ®æ‘˜è¦æå–',
            'å…³é”®ä¿¡æ¯æå–',
            'æ–‡çŒ®ç»“æ„åˆ†æ'
        ]
    },
    'topic-selection': {
        title: 'é€‰é¢˜',
        desc: 'è¾“å…¥ç ”ç©¶é¢†åŸŸæˆ–æ–¹å‘ï¼Œè·å¾—é€‰é¢˜å»ºè®®',
        placeholder: 'è¾“å…¥ç ”ç©¶é¢†åŸŸæˆ–æ–¹å‘ï¼Œè·å¾—é€‰é¢˜å»ºè®®',
        examples: [
            'çƒ­ç‚¹é€‰é¢˜æ¨è',
            'åˆ›æ–°é€‰é¢˜æŒ–æ˜',
            'é€‰é¢˜å¯è¡Œæ€§åˆ†æ'
        ]
    },
    'organize-notes': {
        title: 'ç¬”è®°æ•´ç†',
        desc: 'æ•´ç†å’Œå½’çº³ç ”ç©¶ç¬”è®°ï¼Œå½¢æˆçŸ¥è¯†ä½“ç³»',
        placeholder: 'æ•´ç†å’Œå½’çº³ç ”ç©¶ç¬”è®°ï¼Œå½¢æˆçŸ¥è¯†ä½“ç³»',
        examples: [
            'ç¬”è®°åˆ†ç±»æ•´ç†',
            'çŸ¥è¯†å›¾è°±æ„å»º',
            'ç¬”è®°å…³è”åˆ†æ'
        ]
    },
    // å†™ä½œä¸å‘è¡¨
    'generate-outline': {
        title: 'å‡ºæçº²',
        desc: 'è¾“å…¥ç ”ç©¶ä¸»é¢˜æˆ–è®ºæ–‡æ–¹å‘, è·å¾—é€»è¾‘æ¸…æ™°çš„æçº²',
        placeholder: 'è¾“å…¥ç ”ç©¶ä¸»é¢˜æˆ–è®ºæ–‡æ–¹å‘, è·å¾—é€»è¾‘æ¸…æ™°çš„æçº²',
        examples: [
            'è®ºæ–‡é€»è¾‘æ ‘çŠ¶æçº²è®¾è®¡',
            'é—®é¢˜å¯¼å‘å‹è®ºæ–‡æçº²æ„å»º',
            'çªå‡ºåˆ›æ–°ç‚¹çš„æçº²è®¾è®¡'
        ]
    },
    'writing': {
        title: 'å†™ä½œ',
        desc: 'è¾“å…¥å†™ä½œä¸»é¢˜æˆ–å†™ä½œè¦æ±‚ï¼Œå¼€å§‹ç”Ÿæˆå­¦æœ¯æ–‡æœ¬',
        placeholder: 'è¾“å…¥å†™ä½œä¸»é¢˜æˆ–å†™ä½œè¦æ±‚ï¼Œå¼€å§‹ç”Ÿæˆå­¦æœ¯æ–‡æœ¬',
        examples: [
            'IMRAD ç»“æ„å­¦æœ¯è®ºæ–‡å†™ä½œ',
            'å›¢é˜Ÿåä½œå†™ä½œæ–¹æ¡ˆè®¾è®¡',
            'åŸºäºæ•°æ®çš„å¿«é€Ÿè®ºæ–‡ç”Ÿæˆ'
        ]
    },
    'polish': {
        title: 'æ¶¦è‰²',
        desc: 'ç²˜è´´éœ€è¦æ¶¦è‰²çš„æ–‡æœ¬ï¼Œä¼˜åŒ–è¡¨è¾¾ï¼Œæå‡å­¦æœ¯è§„èŒƒæ€§',
        placeholder: 'ç²˜è´´éœ€è¦æ¶¦è‰²çš„æ–‡æœ¬ï¼Œä¼˜åŒ–è¡¨è¾¾ï¼Œæå‡å­¦æœ¯è§„èŒƒæ€§',
        examples: [
            'ä¸‰è½®é€’è¿›å¼è®ºæ–‡æ¶¦è‰²',
            'æœŸåˆŠåŒè¡Œè¯„è®®æ¨¡æ‹Ÿå®¡æŸ¥',
            'å­¦æœ¯è‹±è¯­é£æ ¼ä¼˜åŒ–'
        ]
    },
    'translate': {
        title: 'ç¿»è¯‘',
        desc: 'ç²˜è´´åŸæ–‡å¹¶æ˜ç¡®ç›®æ ‡è¯­è¨€,å¿«é€Ÿè·å–å­¦æœ¯ç¿»è¯‘',
        placeholder: 'ç²˜è´´åŸæ–‡å¹¶æ˜ç¡®ç›®æ ‡è¯­è¨€,å¿«é€Ÿè·å–å­¦æœ¯ç¿»è¯‘',
        examples: [
            'å­¦æœ¯è®ºæ–‡è§„èŒƒåŒ–ç¿»è¯‘',
            'ä¸­è‹±åŒè¯­å¯¹ç…§æ ¡éªŒ',
            'è·¨æ–‡åŒ–ç¿»è¯‘é€‚é…'
        ]
    },
    'literature-review': {
        title: 'æ–‡çŒ®ç»¼è¿°',
        desc: 'è¾“å…¥æ‚¨æƒ³å†™çš„æ–‡çŒ®ç»¼è¿°çš„ä¸»é¢˜å’Œå­—æ•°ç­‰è¦æ±‚',
        placeholder: 'è¾“å…¥æ‚¨æƒ³å†™çš„æ–‡çŒ®ç»¼è¿°çš„ä¸»é¢˜å’Œå­—æ•°ç­‰è¦æ±‚',
        examples: [
            'PRISMA æ ‡å‡†ç³»ç»Ÿæ€§ç»¼è¿°',
            'èŸèƒåˆ†æç»Ÿè®¡ç»¼åˆ',
            'é¢†åŸŸç†è®ºæ¼”è¿›è„‰ç»œæ¢³ç†'
        ]
    }
};

// æ‰“å¼€åŠŸèƒ½ï¼ˆåœ¨è¾“å…¥æ¡†å†…æ˜¾ç¤ºåŠŸèƒ½æŒ‰é’®ï¼‰
function openFeature(featureType) {
    try {
        // å¤„ç†æ‰€æœ‰é…ç½®çš„åŠŸèƒ½
        if (!featureConfig[featureType]) {
            alert(`æ‰“å¼€åŠŸèƒ½ï¼š${featureType}\n\nï¼ˆå®é™…åº”ç”¨ä¸­åº”è·³è½¬åˆ°å¯¹åº”åŠŸèƒ½é¡µé¢ï¼‰`);
            return;
        }
        
        currentFeature = featureType;
        const config = featureConfig[featureType];
        
        // è·å–å…ƒç´ 
        const featureBtnInline = document.getElementById('featureBtnInline');
        const featureBtnTitle = document.getElementById('featureBtnTitle');
        const featureBtnDesc = document.getElementById('featureBtnDesc');
        const featureExamplesSection = document.getElementById('featureExamplesSection');
        const examplesList = document.getElementById('featureExamplesList');
        const writingInput = document.getElementById('writingQuestionInput');
        
        // æ˜¾ç¤ºåŠŸèƒ½æŒ‰é’®ï¼ˆåœ¨è¾“å…¥æ¡†å†…éƒ¨ï¼‰
        if (featureBtnInline) {
            featureBtnInline.style.display = 'block';
            if (featureBtnTitle) featureBtnTitle.textContent = config.title;
            if (featureBtnDesc) featureBtnDesc.textContent = config.desc;
            
            // æ·»åŠ has-featureç±»ï¼Œè°ƒæ•´è¾“å…¥æ¡†å†…è¾¹è·
            const inputContainer = featureBtnInline.closest('.writing-input-container');
            if (inputContainer) {
                inputContainer.classList.add('has-feature');
            }
        }
        
        // æ›´æ–°è¾“å…¥æ¡†å ä½ç¬¦
        if (writingInput) {
            writingInput.placeholder = config.placeholder;
        }
        
        // æ˜¾ç¤ºå¹¶æ›´æ–°ç¤ºä¾‹åˆ—è¡¨
        if (featureExamplesSection) {
            featureExamplesSection.style.display = 'block';
        }
        if (examplesList) {
            examplesList.innerHTML = config.examples.map(example => {
                const escapedExample = example.replace(/'/g, "\\'");
                return `
                    <div class="feature-example-item" onclick="useExample('${escapedExample}')">
                        <span class="example-text">${example}</span>
                        <span class="example-arrow">â†’</span>
                    </div>
                `;
            }).join('');
        }
    } catch (error) {
        console.error('æ‰“å¼€åŠŸèƒ½æ—¶å‡ºé”™:', error);
        alert('æ‰“å¼€åŠŸèƒ½æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·é‡è¯•');
    }
}

// æ¸…é™¤åŠŸèƒ½ï¼ˆæ¢å¤é»˜è®¤çŠ¶æ€ï¼‰
function clearFeature() {
    try {
        const featureBtnInline = document.getElementById('featureBtnInline');
        const featureExamplesSection = document.getElementById('featureExamplesSection');
        const writingInput = document.getElementById('writingQuestionInput');
        
        if (featureBtnInline) {
            featureBtnInline.style.display = 'none';
            // ç§»é™¤has-featureç±»ï¼Œæ¢å¤è¾“å…¥æ¡†å†…è¾¹è·
            const inputContainer = featureBtnInline.closest('.writing-input-container');
            if (inputContainer) {
                inputContainer.classList.remove('has-feature');
            }
        }
        if (featureExamplesSection) featureExamplesSection.style.display = 'none';
        if (writingInput) {
            writingInput.placeholder = 'è¯¢é—®ä»»ä½•é—®é¢˜, æå‡ºä»»ä½•éœ€æ±‚ (è¾“å…¥@å¿«é€Ÿæ·»åŠ çŸ¥è¯†åº“)';
            writingInput.value = '';
        }
        
        currentFeature = null;
    } catch (error) {
        console.error('æ¸…é™¤åŠŸèƒ½æ—¶å‡ºé”™:', error);
    }
}

// ä½¿ç”¨ç¤ºä¾‹
function useExample(example) {
    try {
        const writingInput = document.getElementById('writingQuestionInput');
        if (writingInput) {
            writingInput.value = example;
            // èšç„¦åˆ°è¾“å…¥æ¡†
            writingInput.focus();
        }
    } catch (error) {
        console.error('ä½¿ç”¨ç¤ºä¾‹æ—¶å‡ºé”™:', error);
    }
}

// æ·»åŠ çŸ¥è¯†åº“
function addKnowledgeBase() {
    document.getElementById('addKnowledgeBaseModal').style.display = 'flex';
}

// é™„ä»¶
function attachFile() {
    alert('æ·»åŠ é™„ä»¶ï¼ˆæ¨¡æ‹Ÿï¼‰\n\nï¼ˆå®é™…åº”ç”¨ä¸­åº”æ‰“å¼€æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†ï¼‰');
}

// è¯­éŸ³è¾“å…¥
function startVoiceInput() {
    alert('è¯­éŸ³è¾“å…¥ï¼ˆæ¨¡æ‹Ÿï¼‰\n\nï¼ˆå®é™…åº”ç”¨ä¸­åº”è°ƒç”¨è¯­éŸ³è¯†åˆ«APIï¼‰');
}

// æäº¤é—®é¢˜
function submitQuestion() {
    const input = document.getElementById('writingQuestionInput');
    const question = input.value.trim();
    
    if (!question) {
        alert('è¯·è¾“å…¥æ‚¨çš„é—®é¢˜æˆ–éœ€æ±‚');
        return;
    }
    
    // å¦‚æœæœ‰é€‰ä¸­çš„åŠŸèƒ½ï¼Œæ˜¾ç¤ºåŠŸèƒ½ä¿¡æ¯
    if (currentFeature) {
        const config = featureConfig[currentFeature];
        alert(`æäº¤${config.title}è¯·æ±‚ï¼š${question}\n\nï¼ˆå®é™…åº”ç”¨ä¸­åº”è°ƒç”¨AIç”ŸæˆAPIï¼‰`);
    } else {
        alert(`æäº¤é—®é¢˜ï¼š${question}\n\nï¼ˆå®é™…åº”ç”¨ä¸­åº”è°ƒç”¨AIé—®ç­”APIï¼‰`);
    }
    
    // ä¸æ¸…ç©ºè¾“å…¥æ¡†ï¼Œè®©ç”¨æˆ·å¯ä»¥ç»§ç»­ç¼–è¾‘
}

// å…³é—­æ·»åŠ çŸ¥è¯†åº“æ¨¡æ€æ¡†
function closeAddKBModal() {
    document.getElementById('addKnowledgeBaseModal').style.display = 'none';
    // é‡ç½®é€‰æ‹©
    selectedKBItems = [];
    updateKBSelection();
}

// é€‰ä¸­çš„çŸ¥è¯†åº“é¡¹
let selectedKBItems = [];

// æ›´æ–°çŸ¥è¯†åº“é€‰æ‹©çŠ¶æ€
function updateKBSelection() {
    const count = selectedKBItems.length;
    document.getElementById('kbSelectedCount').textContent = `å·²é€‰ ${count}/5 é¡¹`;
    document.getElementById('confirmAddKB').disabled = count === 0;
    
    // æ›´æ–°åˆ—è¡¨é¡¹æ ·å¼
    document.querySelectorAll('.add-kb-item').forEach((item, index) => {
        if (selectedKBItems.includes(index)) {
            item.classList.add('selected');
        } else {
            item.classList.remove('selected');
        }
    });
}

// åˆ‡æ¢çŸ¥è¯†åº“é¡¹é€‰æ‹©
function toggleKBItem(index) {
    if (selectedKBItems.includes(index)) {
        selectedKBItems = selectedKBItems.filter(i => i !== index);
    } else {
        if (selectedKBItems.length < 5) {
            selectedKBItems.push(index);
        } else {
            alert('æœ€å¤šåªèƒ½é€‰æ‹©5é¡¹');
            return;
        }
    }
    updateKBSelection();
}

// ç¡®è®¤æ·»åŠ çŸ¥è¯†åº“
function confirmAddKB() {
    if (selectedKBItems.length === 0) {
        alert('è¯·è‡³å°‘é€‰æ‹©ä¸€é¡¹');
        return;
    }
    
    alert(`å·²æ·»åŠ  ${selectedKBItems.length} é¡¹å‚è€ƒèµ„æ–™\n\nï¼ˆå®é™…åº”ç”¨ä¸­åº”è°ƒç”¨APIæ·»åŠ çŸ¥è¯†åº“ï¼‰`);
    closeAddKBModal();
}

// æœç´¢çŸ¥è¯†åº“
function searchKB() {
    const keyword = document.getElementById('kbSearchInput').value.trim();
    // æ¨¡æ‹Ÿæœç´¢
    loadKBList(keyword);
}

// åŠ è½½çŸ¥è¯†åº“åˆ—è¡¨
function loadKBList(keyword = '') {
    const kbList = document.getElementById('kbList');
    
    // æ¨¡æ‹Ÿæ•°æ®ï¼ˆå®é™…åº”ç”¨ä¸­åº”ä»APIè·å–ï¼‰
    const mockKBItems = [
        { name: 'åŒ»å­¦æ–‡çŒ®åº“', desc: 'åŒ…å«1000+ç¯‡åŒ»å­¦ç›¸å…³æ–‡çŒ®' },
        { name: 'ä¸´åºŠæ¡ˆä¾‹åº“', desc: 'æ”¶å½•500+ä¸´åºŠæ¡ˆä¾‹' },
        { name: 'ç ”ç©¶ç¬”è®°', desc: 'ä¸ªäººç ”ç©¶ç¬”è®°å’Œæ‘˜å½•' }
    ];
    
    if (mockKBItems.length === 0) {
        kbList.innerHTML = '<div class="add-kb-empty">æš‚æ— çŸ¥è¯†åº“</div>';
        return;
    }
    
    const filteredItems = keyword 
        ? mockKBItems.filter(item => item.name.includes(keyword) || item.desc.includes(keyword))
        : mockKBItems;
    
    if (filteredItems.length === 0) {
        kbList.innerHTML = '<div class="add-kb-empty">æœªæ‰¾åˆ°ç›¸å…³çŸ¥è¯†åº“</div>';
        return;
    }
    
    kbList.innerHTML = filteredItems.map((item, index) => `
        <div class="add-kb-item" onclick="toggleKBItem(${index})">
            <div class="add-kb-item-checkbox"></div>
            <div class="add-kb-item-info">
                <div class="add-kb-item-name">${item.name}</div>
                <div class="add-kb-item-desc">${item.desc}</div>
            </div>
        </div>
    `).join('');
    
    updateKBSelection();
}

// åˆå§‹åŒ–é¡µé¢
function initPage_research_assistant_writing() {
    console.log('è¾…åŠ©å†™ä½œé¡µé¢å·²åŠ è½½');
    
    // ç¡®ä¿åŠŸèƒ½æŒ‰é’®å’Œç¤ºä¾‹åŒºåŸŸåˆå§‹éšè—
    const featureBtnInline = document.getElementById('featureBtnInline');
    const featureExamplesSection = document.getElementById('featureExamplesSection');
    
    if (featureBtnInline) featureBtnInline.style.display = 'none';
    if (featureExamplesSection) featureExamplesSection.style.display = 'none';
    
    // åˆå§‹åŒ–çŸ¥è¯†åº“æœç´¢
    const kbSearchInput = document.getElementById('kbSearchInput');
    if (kbSearchInput) {
        kbSearchInput.addEventListener('input', function() {
            searchKB();
        });
    }
    
    // æ‰“å¼€æ¨¡æ€æ¡†æ—¶åŠ è½½çŸ¥è¯†åº“åˆ—è¡¨
    const modal = document.getElementById('addKnowledgeBaseModal');
    if (modal) {
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                    if (modal.style.display === 'flex') {
                        loadKBList();
                    }
                }
            });
        });
        observer.observe(modal, { attributes: true });
    }
    
    // ç¡®ä¿å‡½æ•°åœ¨å…¨å±€ä½œç”¨åŸŸ
    if (typeof window.openFeature === 'undefined') {
        window.openFeature = openFeature;
    }
    if (typeof window.clearFeature === 'undefined') {
        window.clearFeature = clearFeature;
    }
    if (typeof window.useExample === 'undefined') {
        window.useExample = useExample;
    }
}
</script>
